#!/bin/bash
#
# Run `superglue' unit tests.
#
# @author Adam Smith <adam@imaginate.life> (http://imaginate.life)
# @copyright 2017 Adam A Smith <adam@imaginate.life> (http://imaginate.life)
#
# @use ./run.tests [...SECTION]
# @val SECTION  Must be a `./SECTION.test' file. If undefined all tests are ran.
# @exit
#   0  PASS  All tests passed.
#   1  FAIL  One or more tests failed.
################################################################################

################################################################################
## CHANGE DIRECTORY
################################################################################

if [[ ! "${0}" =~ ^(\./)?run\.tests$ ]]; then
  cd "${0%/*}"
fi

################################################################################
## LOAD REFS & HELPERS
################################################################################

source ./test.refs
source ./echo.helpers
source ./test.helpers

################################################################################
## MAKE DUMMY DIRECTORIES
################################################################################

for DIR in "${DUMMY_DIRS[@]}"; do
  if [[ ! -d "${DIR}" ]]; then
    mkdir -p 0755 -- "${DIR}"
  fi
done

################################################################################
## RUN TESTS
################################################################################

header

if [[ ${#} -gt 0 ]]; then
  run_tests "${@}"
else
  run_tests ./*.test
fi

results
footer

################################################################################
## REMOVE DUMMY DIRECTORIES
################################################################################

if [[ -d "${DUMMY}" ]]; then
  rm -r -f -- "${DUMMY}"
fi

exit 0

